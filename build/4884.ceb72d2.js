"use strict";(self.webpackChunk_JUPYTERLAB_CORE_OUTPUT=self.webpackChunk_JUPYTERLAB_CORE_OUTPUT||[]).push([[4884],{24884:(t,e,n)=>{n.r(e),n.d(e,{default:()=>w});var s=n(58291);const a=new(n(74547).Token)("@jupyterlite/contents:IContents");var i=n(20927),r=n.n(i);const o="JupyterLite Storage",c=new Set(["application/javascript","application/json","application/manifest+json","application/x-python-code","application/xml","image/svg+xml"]);class l{constructor(t){this._serverContents=new Map,this._storageName=o,this._storageName=(t||{}).contentsStorageName||o,this._storage=this.createDefaultStorage(),this._counters=this.createDefaultCounters(),this._checkpoints=this.createDefaultCheckpoints()}createDefaultStorage(){return r().createInstance({name:this._storageName,description:"Offline Storage for Notebooks and Files",storeName:"files",version:1})}createDefaultCounters(){return r().createInstance({name:this._storageName,description:"Store the current file suffix counters",storeName:"counters",version:1})}createDefaultCheckpoints(){return r().createInstance({name:this._storageName,description:"Offline Storage for Checkpoints",storeName:"checkpoints",version:1})}async newUntitled(t){var e,n,a;const i=null!==(e=null==t?void 0:t.path)&&void 0!==e?e:"",r=null!==(n=null==t?void 0:t.type)&&void 0!==n?n:"notebook",o=(new Date).toISOString();let c=s.PathExt.dirname(i);const l=s.PathExt.basename(i),u=s.PathExt.extname(i),d=await this.get(c);let m,h="";switch(i&&!u&&d?(c=`${i}/`,h=""):c&&l?(c=`${c}/`,h=l):(c="",h=i),r){case"directory":h=`Untitled Folder${await this._incrementCounter("directory")||""}`,m={name:h,path:`${c}${h}`,last_modified:o,created:o,format:"text",mimetype:"",content:null,size:void 0,writable:!0,type:"directory"};break;case"file":{const e=null!==(a=null==t?void 0:t.ext)&&void 0!==a?a:".txt",n=await this._incrementCounter("file");h=h||`untitled${n||""}${e}`,m={name:h,path:`${c}${h}`,last_modified:o,created:o,format:"text",mimetype:"text/plain",content:"",size:0,writable:!0,type:"file"};break}default:{const t=await this._incrementCounter("notebook");h=h||`Untitled${t||""}.ipynb`,m={name:h,path:`${c}${h}`,last_modified:o,created:o,format:"json",mimetype:"application/json",content:p.EMPTY_NB,size:JSON.stringify(p.EMPTY_NB).length,writable:!0,type:"notebook"};break}}const y=m.path;return await this._storage.setItem(y,m),m}async copy(t,e){let n=s.PathExt.basename(t);for(e=""===e?"":`${e.slice(1)}/`;await this.get(`${e}${n}`,{content:!0});){const t=s.PathExt.extname(n),e=n.replace(t,"");n=`${e} (copy)${t}`}const a=`${e}${n}`;let i=await this.get(t,{content:!0});if(!i)throw Error(`Could not find file with path ${t}`);return i={...i,name:n,path:a},await this._storage.setItem(a,i),i}async get(t,e){if(""===(t=decodeURIComponent(t.replace(/^\//,""))))return await this._getFolder(t);const n=await this._storage.getItem(t),a=await this._getServerContents(t,e),i=n||a;if(!i)return null;if(!(null==e?void 0:e.content))return{...i,content:null,size:void 0};if("directory"===i.type){const e=new Map;await this._storage.iterate(((n,s)=>{const a=n;s===`${t}/${a.name}`&&e.set(a.name,a)}));const n=a?a.content:Array.from((await this._getServerDirectory(t)).values());for(const t of n)e.has(t.name)||e.set(t.name,t);const r=[...e.values()];return{name:s.PathExt.basename(t),path:t,last_modified:i.last_modified,created:i.created,format:"json",mimetype:"application/json",content:r,size:void 0,writable:!0,type:"directory"}}return i}async rename(t,e){const n=decodeURIComponent(t),a=await this.get(n,{content:!0});if(!a)throw Error(`Could not find file with path ${n}`);const i=(new Date).toISOString(),r=s.PathExt.basename(e),o={...a,name:r,path:e,last_modified:i};if(await this._storage.setItem(e,o),await this._storage.removeItem(n),await this._checkpoints.removeItem(n),"directory"===a.type){let n;for(n of a.content)await this.rename(s.URLExt.join(t,n.name),s.URLExt.join(e,n.name))}return o}async save(t,e={}){var n;t=decodeURIComponent(t);let a=await this.get(t)||await this.newUntitled({path:t});if(!a)return null;const i=(new Date).toISOString();a={...a,...e,last_modified:i};const r=s.PathExt.extname(null!==(n=e.name)&&void 0!==n?n:"");if(e.content&&"base64"===e.format){const t=decodeURIComponent(escape(atob(e.content))),n=".ipynb"===r;a={...a,content:n?JSON.parse(t):t,format:n?"json":"text",type:n?"notebook":"file"}}return await this._storage.setItem(t,a),a}async delete(t){t=decodeURIComponent(t);const e=[];await this._storage.iterate(((n,s)=>{(s===t||s.startsWith(`${t}/`))&&e.push(s)})),await Promise.all(e.map((async t=>Promise.all([this._storage.removeItem(t),this._checkpoints.removeItem(t)]))))}async createCheckpoint(t){var e;t=decodeURIComponent(t);const n=await this.get(t,{content:!0});if(!n)throw Error(`Could not find file with path ${t}`);const s=(null!==(e=await this._checkpoints.getItem(t))&&void 0!==e?e:[]).filter((t=>!!t));return s.push(n),s.length>5&&s.splice(0,s.length-5),await this._checkpoints.setItem(t,s),{id:""+(s.length-1),last_modified:n.last_modified}}async listCheckpoints(t){return(await this._checkpoints.getItem(t)||[]).filter((t=>!!t)).map(((t,e)=>({id:e.toString(),last_modified:t.last_modified})))}async restoreCheckpoint(t,e){t=decodeURIComponent(t);const n=(await this._checkpoints.getItem(t)||[])[parseInt(e)];await this._storage.setItem(t,n)}async deleteCheckpoint(t,e){t=decodeURIComponent(t);const n=await this._checkpoints.getItem(t)||[],s=parseInt(e);n.splice(s,1),await this._checkpoints.setItem(t,n)}async _getFolder(t){const e=new Map;await this._storage.iterate(((t,n)=>{if(n.includes("/"))return;const s=t;e.set(s.path,s)}));for(const n of(await this._getServerDirectory(t)).values())e.has(n.path)||e.set(n.path,n);return t&&0===e.size?null:{name:"",path:t,last_modified:new Date(0).toISOString(),created:new Date(0).toISOString(),format:"json",mimetype:"application/json",content:Array.from(e.values()),size:void 0,writable:!0,type:"directory"}}async _getServerContents(t,e){const n=s.PathExt.basename(t);let a=(await this._getServerDirectory(s.URLExt.join(t,".."))).get(n);if(!a)return null;if(a=a||{name:n,path:t,last_modified:new Date(0).toISOString(),created:new Date(0).toISOString(),format:"text",mimetype:"text/plain",type:"file",writable:!0,content:null},null==e?void 0:e.content)if("directory"===a.type){const e=await this._getServerDirectory(t);a={...a,content:Array.from(e.values())}}else{const e=s.URLExt.join(s.PageConfig.getBaseUrl(),"files",t),n=await fetch(e);if(!n.ok)return null;const i=a.mimetype||n.headers.get("Content-Type");a="notebook"===a.type||-1!==(null==i?void 0:i.indexOf("json"))||t.match(/\.(ipynb|[^/]*json[^/]*)$/)?{...a,content:await n.json(),format:"json",mimetype:a.mimetype||"application/json"}:-1!==i.indexOf("text")||c.has(i)?{...a,content:await n.text(),format:"text",mimetype:i||"text/plain"}:{...a,content:btoa(String.fromCharCode(...new Uint8Array(await n.arrayBuffer()))),format:"base64",mimetype:i||"octet/stream"}}return a}async _getServerDirectory(t){const e=this._serverContents.get(t)||new Map;if(!this._serverContents.has(t)){const n=s.URLExt.join(s.PageConfig.getBaseUrl(),"api/contents",t,"all.json");try{const t=await fetch(n),s=JSON.parse(await t.text());for(const t of s.content)e.set(t.name,t)}catch(t){console.warn(`don't worry, about ${t}... nothing's broken. if there had been a\n          file at ${n}, you might see some more files.`)}this._serverContents.set(t,e)}return e}async _incrementCounter(t){var e;const n=(null!==(e=await this._counters.getItem(t))&&void 0!==e?e:-1)+1;return await this._counters.setItem(t,n),n}}var p;!function(t){t.EMPTY_NB={metadata:{orig_nbformat:4},nbformat_minor:4,nbformat:4,cells:[]}}(p||(p={}));var u=n(19587),d=n(33835),m=n(2917),h=n(33360),y=n(11353);const w=[{id:"@jupyterlite/server-extension:contents",autoStart:!0,provides:a,activate:t=>{const e=s.PageConfig.getOption("contentsStorageName");return new l({contentsStorageName:e})}},{id:"@jupyterlite/server-extension:contents-routes",autoStart:!0,requires:[a],activate:(t,e)=>{t.router.get("/api/contents/(.+)/checkpoints",(async(t,n)=>{const s=await e.listCheckpoints(n);return new Response(JSON.stringify(s))})),t.router.post("/api/contents/(.+)/checkpoints/(.*)",(async(t,n,s)=>{const a=await e.restoreCheckpoint(n,s);return new Response(JSON.stringify(a),{status:204})})),t.router.post("/api/contents/(.+)/checkpoints",(async(t,n)=>{const s=await e.createCheckpoint(n);return new Response(JSON.stringify(s),{status:201})})),t.router.delete("/api/contents/(.+)/checkpoints/(.*)",(async(t,n,s)=>{const a=await e.deleteCheckpoint(n,s);return new Response(JSON.stringify(a),{status:204})})),t.router.get("/api/contents(.*)",(async(t,n)=>{var s;const a={content:"1"===(null===(s=t.query)||void 0===s?void 0:s.content)},i=await e.get(n,a);return i?new Response(JSON.stringify(i)):new Response(null,{status:404})})),t.router.post("/api/contents(.*)",(async(t,n)=>{const s=t.body,a=null==s?void 0:s.copy_from;let i;return i=a?await e.copy(a,n):await e.newUntitled(s),i?new Response(JSON.stringify(i),{status:201}):new Response(null,{status:400})})),t.router.patch("/api/contents(.*)",(async(t,n)=>{var s,a;const i=null!==(a=null===(s=t.body)||void 0===s?void 0:s.path)&&void 0!==a?a:"";n="/"===n[0]?n.slice(1):n;const r=await e.rename(n,i);return new Response(JSON.stringify(r))})),t.router.put("/api/contents/(.+)",(async(t,n)=>{const s=t.body,a=await e.save(n,s);return new Response(JSON.stringify(a))})),t.router.delete("/api/contents/(.+)",(async(t,n)=>(await e.delete(n),new Response(null,{status:204}))))}},{id:"@jupyterlite/server-extension:kernels",autoStart:!0,provides:u.IKernels,requires:[u.IKernelSpecs],activate:(t,e)=>new u.Kernels({kernelspecs:e})},{id:"@jupyterlite/server-extension:kernels-routes",autoStart:!0,requires:[u.IKernels],activate:(t,e)=>{t.router.post("/api/kernels/(.*)/restart",(async(t,n)=>{const s=await e.restart(n);return new Response(JSON.stringify(s))})),t.router.delete("/api/kernels/(.*)",(async(t,n)=>{const s=await e.shutdown(n);return new Response(JSON.stringify(s),{status:204})}))}},{id:"@jupyterlite/server-extension:kernelspec",autoStart:!0,provides:u.IKernelSpecs,activate:t=>new u.KernelSpecs({})},{id:"@jupyterlite/server-extension:kernelspec-routes",autoStart:!0,requires:[u.IKernelSpecs],activate:(t,e)=>{t.router.get("/api/kernelspecs",(async t=>{const n=e.specs;return new Response(JSON.stringify(n))}))}},{id:"@jupyterlite/server-extension:licenses",autoStart:!0,provides:d.ILicenses,activate:t=>new d.Licenses},{id:"@jupyterlite/server-extension:licenses-routes",autoStart:!0,requires:[d.ILicenses],activate(t,e){t.router.get("/api/licenses",(async t=>{const n=await e.get();return new Response(JSON.stringify(n))}))}},{id:"@jupyterlite/server-extension:nbconvert-routes",autoStart:!0,activate:t=>{t.router.get("/api/nbconvert",(async t=>new Response(JSON.stringify({}))))}},{id:"@jupyterlite/server-extension:sessions",autoStart:!0,provides:m.ISessions,requires:[u.IKernels],activate:(t,e)=>new m.Sessions({kernels:e})},{id:"@jupyterlite/server-extension:sessions-routes",autoStart:!0,requires:[m.ISessions],activate:(t,e)=>{t.router.get("/api/sessions/(.+)",(async(t,n)=>{const s=await e.get(n);return new Response(JSON.stringify(s),{status:200})})),t.router.get("/api/sessions",(async t=>{const n=await e.list();return new Response(JSON.stringify(n),{status:200})})),t.router.patch("/api/sessions(.*)",(async(t,n)=>{const s=t.body,a=await e.patch(s);return new Response(JSON.stringify(a),{status:200})})),t.router.delete("/api/sessions/(.+)",(async(t,n)=>(await e.shutdown(n),new Response(null,{status:204})))),t.router.post("/api/sessions",(async t=>{const n=t.body,s=await e.startNew(n);return new Response(JSON.stringify(s),{status:201})}))}},{id:"@jupyterlite/server-extension:settings",autoStart:!0,provides:h.ISettings,activate:t=>{const e=s.PageConfig.getOption("settingsStorageName");return new h.Settings({settingsStorageName:e})}},{id:"@jupyterlite/server-extension:settings-routes",autoStart:!0,requires:[h.ISettings],activate:(t,e)=>{const n="/api/settings/((?:@([^/]+?)[/])?([^/]+?):([^:]+))$";t.router.get(n,(async(t,n)=>{const s=await e.get(n);return new Response(JSON.stringify(s))})),t.router.put(n,(async(t,n)=>{const s=t.body,{raw:a}=s;return await e.save(n,a),new Response(null,{status:204})})),t.router.get("/api/settings",(async t=>{const n=await e.getAll();return new Response(JSON.stringify(n))}))}},{id:"@jupyterlite/server-extension:translation",autoStart:!0,provides:y.ITranslation,activate:t=>{const e=new y.Translation;return t.router.get("/api/translations/?(.*)",(async(t,n)=>{const s=await e.get(n||"all");return new Response(JSON.stringify(s))})),e}},{id:"@jupyterlite/server-extension:translation-routes",autoStart:!0,requires:[y.ITranslation],activate:(t,e)=>{t.router.get("/api/translations/?(.*)",(async(t,n)=>{const s=await e.get(n||"all");return new Response(JSON.stringify(s))}))}}]}}]);
//# sourceMappingURL=4884.ceb72d2.js.map